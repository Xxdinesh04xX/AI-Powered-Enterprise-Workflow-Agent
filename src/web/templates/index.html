<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Enterprise Workflow Agent</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="/static/css/style.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div>
                        <div>AI Workflow Agent</div>
                        <div style="font-size: 0.75rem; opacity: 0.8; font-weight: 400;">Enterprise Automation Platform</div>
                    </div>
                </div>
                
                <nav>
                    <ul class="nav-links">
                        <li><a href="#dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                        <li><a href="#tasks"><i class="fas fa-tasks"></i> Tasks</a></li>
                        <li><a href="#reports"><i class="fas fa-chart-bar"></i> Reports</a></li>
                        <li><a href="#teams"><i class="fas fa-users"></i> Teams</a></li>
                        <li><a href="/docs" target="_blank"><i class="fas fa-code"></i> API</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="fade-in">
                <h2><i class="fas fa-tachometer-alt"></i> System Dashboard</h2>
                
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-value" id="total-tasks">-</div>
                        <div class="stat-label">Total Tasks</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-value" id="completed-tasks">-</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="pending-tasks">-</div>
                        <div class="stat-label">Pending</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-value">12</div>
                        <div class="stat-label">Active Teams</div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-plus-circle"></i> Create New Task</h3>
                            <p class="card-subtitle">Submit a new work request for AI processing</p>
                        </div>
                        
                        <form id="create-task-form">
                            <div class="form-group">
                                <label class="form-label" for="task-title">Task Title</label>
                                <input type="text" id="task-title" class="form-input" placeholder="Brief description of the task" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="task-description">Detailed Description</label>
                                <textarea id="task-description" class="form-textarea" placeholder="Provide detailed information about what needs to be done..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="task-request">Original Request</label>
                                <textarea id="task-request" class="form-textarea" placeholder="The original request as submitted by the user..." required></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-magic"></i>
                                Create & Auto-Process
                            </button>
                        </form>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title"><i class="fas fa-brain"></i> AI Classification Test</h3>
                            <p class="card-subtitle">Test the AI classification system</p>
                        </div>
                        
                        <form id="classify-form">
                            <div class="form-group">
                                <label class="form-label" for="classify-text">Text to Classify</label>
                                <textarea id="classify-text" class="form-textarea" placeholder="Enter any work request to see how the AI classifies it..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="classify-strategy">Strategy</label>
                                <select id="classify-strategy" class="form-select">
                                    <option value="hybrid">Hybrid (Recommended)</option>
                                    <option value="keyword">Keyword-based</option>
                                    <option value="rule">Rule-based</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="btn btn-secondary">
                                <i class="fas fa-search"></i>
                                Classify Text
                            </button>
                        </form>
                        
                        <div id="classification-result" class="mt-3" style="display: none;">
                            <h4>Classification Result:</h4>
                            <div id="classification-details"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tasks Section -->
            <section id="tasks" class="fade-in" style="margin-top: 3rem;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-list"></i> Recent Tasks</h3>
                        <p class="card-subtitle">Latest tasks processed by the system</p>
                    </div>
                    
                    <div class="task-list" id="task-list">
                        <div class="task-item" style="text-align: center; padding: 3rem;">
                            <div class="loading"></div>
                            <p style="margin-top: 1rem; color: var(--text-muted);">Loading tasks...</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button class="btn btn-secondary" onclick="loadTasks()">
                            <i class="fas fa-refresh"></i>
                            Refresh Tasks
                        </button>
                    </div>
                </div>
            </section>

            <!-- Reports Section -->
            <section id="reports" class="fade-in" style="margin-top: 3rem;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-bar"></i> Generate Reports</h3>
                        <p class="card-subtitle">Create comprehensive analytics reports</p>
                    </div>
                    
                    <div class="grid grid-3">
                        <button class="btn btn-success" onclick="generateReport('daily')">
                            <i class="fas fa-calendar-day"></i>
                            Daily Report
                        </button>
                        
                        <button class="btn btn-warning" onclick="generateReport('weekly')">
                            <i class="fas fa-calendar-week"></i>
                            Weekly Report
                        </button>
                        
                        <button class="btn btn-error" onclick="generateReport('monthly')">
                            <i class="fas fa-calendar-alt"></i>
                            Monthly Report
                        </button>
                    </div>
                    
                    <div id="report-status" style="margin-top: 1rem; display: none;">
                        <div class="loading" style="margin-right: 0.5rem;"></div>
                        <span>Generating report...</span>
                    </div>
                </div>
            </section>

            <!-- Teams Section -->
            <section id="teams" class="fade-in" style="margin-top: 3rem;">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-users"></i> Team Overview</h3>
                        <p class="card-subtitle">Available teams and their capabilities</p>
                    </div>
                    
                    <div class="grid grid-3" id="teams-grid">
                        <div style="text-align: center; padding: 2rem;">
                            <div class="loading"></div>
                            <p style="margin-top: 1rem; color: var(--text-muted);">Loading teams...</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" style="position: fixed; top: 1rem; right: 1rem; z-index: 1000;"></div>

    <!-- JavaScript -->
    <script>
        // API Configuration
        const API_BASE = 'http://127.0.0.1:8000/api/v1';
        const API_KEY = 'dev-key-123';

        // Utility Functions
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.style.cssText = `
                background: ${type === 'success' ? 'var(--gradient-success)' :
                           type === 'error' ? 'var(--gradient-secondary)' :
                           'var(--gradient-primary)'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                margin-bottom: 0.5rem;
                box-shadow: var(--shadow-lg);
                animation: slideIn 0.3s ease-out;
                cursor: pointer;
            `;
            toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'times' : 'info'}"></i> ${message}`;

            document.getElementById('toast-container').appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, 3000);

            toast.onclick = () => toast.remove();
        }

        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'X-API-Key': API_KEY,
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return await response.json();
            } catch (error) {
                console.error('API call failed:', error);
                showToast(`API Error: ${error.message}`, 'error');
                throw error;
            }
        }

        // Load Statistics
        async function loadStats() {
            try {
                const stats = await apiCall('/statistics');
                document.getElementById('total-tasks').textContent = stats.total_tasks;
                document.getElementById('completed-tasks').textContent = stats.tasks_by_status.completed || 0;
                document.getElementById('pending-tasks').textContent = stats.tasks_by_status.pending || 0;
            } catch (error) {
                console.error('Failed to load stats:', error);
            }
        }

        // Load Tasks
        async function loadTasks() {
            try {
                const response = await apiCall('/tasks/?per_page=10');
                const taskList = document.getElementById('task-list');

                if (response.items.length === 0) {
                    taskList.innerHTML = `
                        <div class="task-item" style="text-align: center; padding: 3rem;">
                            <i class="fas fa-inbox" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 1rem;"></i>
                            <p style="color: var(--text-muted);">No tasks found. Create your first task above!</p>
                        </div>
                    `;
                    return;
                }

                taskList.innerHTML = response.items.map(task => `
                    <div class="task-item">
                        <div class="task-header">
                            <h4 class="task-title">${task.title}</h4>
                            <div class="task-meta">
                                <span class="badge badge-${task.status.replace('_', '-')}">${task.status.replace('_', ' ')}</span>
                                ${task.priority ? `<span class="badge badge-${task.priority.toLowerCase()}">${task.priority}</span>` : ''}
                                ${task.category ? `<span class="badge" style="background: rgba(102, 126, 234, 0.1); color: var(--primary-color);">${task.category}</span>` : ''}
                            </div>
                        </div>
                        <div class="task-description">${task.description}</div>
                        <div class="task-footer">
                            <span><i class="fas fa-calendar"></i> ${new Date(task.created_at).toLocaleDateString()}</span>
                            ${task.assigned_team_id ? `<span><i class="fas fa-users"></i> Team ${task.assigned_team_id}</span>` : ''}
                            ${task.classification_confidence ? `<span><i class="fas fa-brain"></i> ${(task.classification_confidence * 100).toFixed(0)}% confidence</span>` : ''}
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('task-list').innerHTML = `
                    <div class="task-item" style="text-align: center; padding: 3rem;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; color: var(--error-color); margin-bottom: 1rem;"></i>
                        <p style="color: var(--error-color);">Failed to load tasks. Please try again.</p>
                    </div>
                `;
            }
        }

        // Create Task
        document.getElementById('create-task-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> Creating...';
            submitBtn.disabled = true;

            try {
                const taskData = {
                    title: document.getElementById('task-title').value,
                    description: document.getElementById('task-description').value,
                    original_request: document.getElementById('task-request').value
                };

                const result = await apiCall('/tasks/', {
                    method: 'POST',
                    body: JSON.stringify(taskData)
                });

                showToast('Task created successfully! AI is processing...', 'success');
                e.target.reset();
                loadTasks();
                loadStats();
            } catch (error) {
                showToast('Failed to create task', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Classify Text
        document.getElementById('classify-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<div class="loading"></div> Classifying...';
            submitBtn.disabled = true;

            try {
                const classifyData = {
                    text: document.getElementById('classify-text').value,
                    strategy: document.getElementById('classify-strategy').value
                };

                const result = await apiCall('/tasks/classify', {
                    method: 'POST',
                    body: JSON.stringify(classifyData)
                });

                const resultDiv = document.getElementById('classification-result');
                const detailsDiv = document.getElementById('classification-details');

                detailsDiv.innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                            <strong>Category:</strong><br>
                            <span class="badge" style="background: rgba(102, 126, 234, 0.1); color: var(--primary-color); margin-top: 0.5rem;">${result.category}</span>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                            <strong>Priority:</strong><br>
                            <span class="badge badge-${result.priority.toLowerCase()}" style="margin-top: 0.5rem;">${result.priority}</span>
                        </div>
                        <div style="padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                            <strong>Confidence:</strong><br>
                            <span style="font-size: 1.25rem; font-weight: 600; color: var(--success-color);">${(result.confidence * 100).toFixed(1)}%</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                        <strong>Reasoning:</strong><br>
                        <span style="color: var(--text-secondary);">${result.reasoning}</span>
                    </div>
                `;

                resultDiv.style.display = 'block';
                showToast('Text classified successfully!', 'success');
            } catch (error) {
                showToast('Failed to classify text', 'error');
            } finally {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // Generate Report
        async function generateReport(type) {
            const statusDiv = document.getElementById('report-status');
            statusDiv.style.display = 'block';

            try {
                const reportData = {
                    report_type: type,
                    output_formats: ['html', 'json'],
                    include_analytics: true,
                    use_ai_insights: false
                };

                const result = await apiCall('/reports/generate', {
                    method: 'POST',
                    body: JSON.stringify(reportData)
                });

                showToast(`${type.charAt(0).toUpperCase() + type.slice(1)} report generated successfully!`, 'success');

                // Show download links
                const downloadHtml = `
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-secondary); border-radius: 8px;">
                        <strong>Report Generated:</strong><br>
                        <div style="margin-top: 0.5rem;">
                            ${Object.entries(result.generated_files).map(([format, path]) =>
                                `<a href="${path}" target="_blank" class="btn btn-secondary" style="margin-right: 0.5rem; margin-top: 0.5rem;">
                                    <i class="fas fa-download"></i> ${format.toUpperCase()}
                                </a>`
                            ).join('')}
                        </div>
                    </div>
                `;
                statusDiv.innerHTML = downloadHtml;
            } catch (error) {
                statusDiv.innerHTML = '<span style="color: var(--error-color);">Failed to generate report</span>';
            }
        }

        // Load Teams (placeholder)
        function loadTeams() {
            const teamsGrid = document.getElementById('teams-grid');
            const teams = [
                { name: 'DevOps Team', category: 'IT', members: 4, workload: '75%' },
                { name: 'Security Team', category: 'IT', members: 3, workload: '60%' },
                { name: 'Recruitment Team', category: 'HR', members: 2, workload: '90%' },
                { name: 'Payroll Team', category: 'HR', members: 3, workload: '45%' },
                { name: 'Project Management', category: 'Operations', members: 5, workload: '80%' },
                { name: 'Quality Assurance', category: 'Operations', members: 4, workload: '65%' }
            ];

            teamsGrid.innerHTML = teams.map(team => `
                <div class="card" style="margin: 0;">
                    <h4 style="margin-bottom: 0.5rem;">${team.name}</h4>
                    <p style="color: var(--text-muted); margin-bottom: 1rem;">${team.category}</p>
                    <div style="display: flex; justify-content: space-between; font-size: 0.875rem;">
                        <span><i class="fas fa-users"></i> ${team.members} members</span>
                        <span><i class="fas fa-chart-bar"></i> ${team.workload} load</span>
                    </div>
                </div>
            `).join('');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadTasks();
            loadTeams();

            // Smooth scrolling for navigation
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });
        });
    </script>
</body>
</html>
